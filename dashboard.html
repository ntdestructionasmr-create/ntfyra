<!DOCTYPE html>
<html>
<head>
  <title>NTFYRA Dashboard</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    .tabs{display:flex;gap:8px;margin-bottom:16px}
    .tab{flex:1;padding:12px;border:none;border-radius:14px;background:#eef1f4;cursor:pointer}
    .tab.active{background:#00c853;color:#fff}
    .section{display:none}
    .section.active{display:block}
    .box{background:#f4f6f9;padding:14px;border-radius:14px;margin-bottom:14px}
    .hidden{display:none}
    .workout-day{background:#fff;padding:10px;border-radius:10px;margin-bottom:8px}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center}
    .modal-box{background:#fff;padding:20px;border-radius:14px;max-width:300px;text-align:center}
    .ai-box{background:#e8f5e9;border-left:5px solid #00c853;padding:14px;border-radius:12px}
  </style>
</head>

<body>

<script>
  // ---- STATE (ONLY THESE) ----
  let isPremium = localStorage.getItem("premium") === "true";
  let workoutDone = localStorage.getItem("workoutDone") === "true";
  let progressDone = localStorage.getItem("progressDone") === "true";

  function canShowPaywall(){
    return (!isPremium && workoutDone && progressDone);
  }
</script>

<div class="container">
  <h1>Dashboard</h1>

  <!-- TABS -->
  <div class="tabs">
    <button class="tab active" onclick="openTab('user',this)">User</button>
    <button class="tab" onclick="openTab('workout',this)">Workouts</button>
    <button class="tab" onclick="openTab('progress',this)">Progress</button>
    <button class="tab" onclick="onAIClick(this)">AI Coach ðŸ”’</button>
  </div>

  <!-- USER -->
  <div id="user" class="section active">
    <div class="box">
      <label>Workout Type</label>
      <select id="workoutType" onchange="checkWorkout()">
        <option value="">Select</option>
        <option value="home">Home</option>
        <option value="gym">Gym</option>
      </select>

      <div id="gymBox" class="hidden">
        <label>Gym Level</label>
        <select id="gymLevel">
          <option value="beginner">Beginner</option>
          <option value="advanced">Advanced</option>
        </select>
      </div>

      <button onclick="generateWorkout()">Generate Workout</button>
    </div>
  </div>

  <!-- WORKOUT -->
  <div id="workout" class="section">
    <div class="box" id="workoutContent">Generate workout first.</div>
  </div>

  <!-- PROGRESS -->
  <div id="progress" class="section">
    <div class="box">
      <input type="number" id="todayWeight" placeholder="Today's weight">
      <button onclick="addProgress()">Add</button>
    </div>
    <div class="box">
      <canvas id="weightChart"></canvas>
    </div>
  </div>

  <!-- AI -->
  <div id="ai" class="section">
    <div class="ai-box" id="aiAdvice">
      Premium AI Coach unlocked ðŸš€
    </div>
  </div>
</div>

<!-- PREMIUM MODAL -->
<div id="premiumModal" class="modal hidden">
  <div class="modal-box">
    <h3>Upgrade to Premium ðŸš€</h3>
    <p>Unlock AI Coach & advanced workouts</p>
    <p><b>â‚¹99 / month</b></p>
    <button onclick="unlockPremium()">Upgrade</button><br><br>
    <button onclick="closePremium()">Later</button>
  </div>
</div>

<script>
/* ---------- BASIC TABS ---------- */
function openTab(id,btn){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById(id).classList.add('active');
}

/* ---------- AI CLICK (ONLY PLACE POPUP CAN OPEN) ---------- */
function onAIClick(btn){
  if(canShowPaywall()){
    document.getElementById("premiumModal").classList.remove("hidden");
    return;
  }
  if(!workoutDone || !progressDone){
    alert("Use workouts & progress first ðŸ™‚");
    return;
  }
  openTab('ai',btn);
}

/* ---------- MODAL ---------- */
function closePremium(){
  document.getElementById("premiumModal").classList.add("hidden");
}
function unlockPremium(){
  localStorage.setItem("premium","true");
  isPremium=true;
  closePremium();
  alert("Premium unlocked ðŸŽ‰");
}

/* ---------- WORKOUT ---------- */
function checkWorkout(){
  workoutType.value==="gym"
    ? gymBox.classList.remove("hidden")
    : gymBox.classList.add("hidden");
}

function generateWorkout(){
  localStorage.setItem("workoutDone","true");
  workoutDone=true;

  workoutContent.innerHTML = `
    <div class="workout-day">Full Body</div>
    <div class="workout-day">Cardio</div>
    <div class="workout-day">Core</div>
  `;
  document.querySelectorAll('.tab')[1].click();
}

/* ---------- PROGRESS ---------- */
let weights = JSON.parse(localStorage.getItem("weights")||"[]");

function addProgress(){
  const w=Number(todayWeight.value);
  if(!w) return;

  weights.push(w);
  localStorage.setItem("weights",JSON.stringify(weights));

  localStorage.setItem("progressDone","true");
  progressDone=true;

  todayWeight.value="";
  drawChart();
}

function drawChart(){
  new Chart(weightChart,{
    type:'line',
    data:{
      labels:weights.map((_,i)=>`Day ${i+1}`),
      datasets:[{data:weights,borderColor:'#00c853'}]
    },
    options:{plugins:{legend:{display:false}}}
  });
}
</script>

</body>
</html>
